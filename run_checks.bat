@echo off
REM –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ (–∞–Ω–∞–ª–æ–≥ GitHub Actions) - Windows –≤–µ—Ä—Å–∏—è
REM –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π

echo.
echo ========================================
echo üöÄ –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞...
echo ========================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ Python
python --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Python –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.9+
    exit /b 1
)
echo ‚úì Python –Ω–∞–π–¥–µ–Ω

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if "%VIRTUAL_ENV%"=="" (
    echo ‚ö† –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
    echo –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å venv:
    echo   python -m venv venv
    echo   venv\Scripts\activate
    echo.
) else (
    echo ‚úì –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
)

REM –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo.
echo üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...
pip install -q -r requirements.txt
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    exit /b 1
)
echo ‚úì –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
echo.

REM 1. Flake8
echo üîç –ó–∞–ø—É—Å–∫ flake8 (–ª–∏–Ω—Ç–∏–Ω–≥)...
flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
if errorlevel 1 (
    echo ‚ùå –ù–∞–π–¥–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞!
    exit /b 1
)
echo ‚úì –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
echo.

REM 2. Black
echo üé® –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (black)...
black --check --diff .
if errorlevel 1 (
    echo ‚ö† –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã —Ç—Ä–µ–±—É—é—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    echo –ó–∞–ø—É—Å—Ç–∏—Ç–µ: black .
) else (
    echo ‚úì –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
)
echo.

REM 3. Isort
echo üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–≤ (isort)...
isort --check-only --diff .
if errorlevel 1 (
    echo ‚ö† –ò–º–ø–æ—Ä—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    echo –ó–∞–ø—É—Å—Ç–∏—Ç–µ: isort .
) else (
    echo ‚úì –ò–º–ø–æ—Ä—Ç—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
)
echo.

REM 4. MyPy
echo üîé –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (mypy)...
mypy src --ignore-missing-imports --no-strict-optional
if errorlevel 1 (
    echo ‚ö† –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏
) else (
    echo ‚úì –¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
)
echo.

REM 5. Pytest
echo üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (pytest)...
pytest tests/ -v --tb=short --maxfail=5
if errorlevel 1 (
    echo ‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å!
    exit /b 1
)
echo ‚úì –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
echo.

REM 6. Coverage
echo üìä –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞...
pytest tests/ --cov=src --cov-report=term --cov-report=html --cov-report=xml -q
echo HTML –æ—Ç—á—ë—Ç: htmlcov\index.html
echo.

REM 7. Bandit
echo üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (bandit)...
bandit -r src/ -f json -o bandit-report.json -q
if errorlevel 1 (
    echo ‚ö† –ù–∞–π–¥–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    echo –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ bandit-report.json
) else (
    echo ‚úì –ü—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
)
echo.

REM 8. Safety
echo üõ°Ô∏è  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (safety)...
safety check --json > safety-report.json 2>&1
if errorlevel 1 (
    echo ‚ö† –ù–∞–π–¥–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
    echo –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ safety-report.json
) else (
    echo ‚úì –£—è–∑–≤–∏–º–æ—Å—Ç–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
)
echo.

REM –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç
echo ================================================
echo ‚ú® –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê
echo ================================================
echo.
echo –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
echo   ‚Ä¢ HTML –æ—Ç—á—ë—Ç: htmlcov\index.html
echo   ‚Ä¢ XML –æ—Ç—á—ë—Ç: coverage.xml
echo.
echo –ì–æ—Ç–æ–≤–æ –∫ –∫–æ–º–º–∏—Ç—É! üéâ
echo.

pause
